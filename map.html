<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè´ Svenska F√∂rskolor Karta - Interaktiv 3D Karta</title>
    
    <!-- Mapbox CSS -->
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1e293b;
        }
        
        .header {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        
        .main-container {
            display: flex;
            height: calc(100vh - 120px);
        }
        
        .sidebar {
            width: 400px;
            background: white;
            border-right: 1px solid #e2e8f0;
            overflow-y: auto;
            box-shadow: 2px 0 4px rgba(0,0,0,0.1);
        }
        
        .search-section {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .stats-section {
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3b82f6;
        }
        
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            z-index: 1000;
        }
        
        .preschool-list {
            padding: 20px;
        }
        
        .preschool-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .preschool-item:hover {
            background: #f1f5f9;
        }
        
        .preschool-name {
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 5px;
        }
        
        .preschool-info {
            color: #64748b;
            font-size: 0.9em;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .control-button {
            background: white;
            border: 1px solid #e2e8f0;
            padding: 10px 15px;
            border-radius: 6px;
            margin-left: 10px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .control-button:hover {
            background: #f8fafc;
        }
        
        @media (max-width: 768px) {
            .main-container { flex-direction: column; }
            .sidebar { width: 100%; height: 300px; }
            .map-container { height: 400px; }
        }

        .success-message {
            background: #dcfce7;
            border: 1px solid #16a34a;
            color: #15803d;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè´ Svenska F√∂rskolor Karta</h1>
        <p>Interaktiv 3D-karta √∂ver svenska f√∂rskolor med omfattande statistik</p>
    </div>

    <div class="success-message">
        ‚úÖ <strong>Siten laddad framg√•ngsrikt!</strong> Kartan initialiseras...
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="search-section">
                <input type="text" class="search-input" placeholder="S√∂k f√∂rskola eller kommun..." id="searchInput">
            </div>
            
            <div class="stats-section">
                <h3>üìä Statistik</h3>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalCount">540+</div>
                        <div>F√∂rskolor</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="municipalityCount">290</div>
                        <div>Kommuner</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="averageRating">4.2</div>
                        <div>Medelbetyg</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="withCoordinates">420</div>
                        <div>Med Koordinater</div>
                    </div>
                </div>
            </div>
            
            <div class="preschool-list" id="preschoolList">
                <div class="preschool-item">
                    <div class="preschool-name">üè´ L√§sanden F√∂rskola</div>
                    <div class="preschool-info">Stockholm ‚Ä¢ 45 barn ‚Ä¢ Kommunal</div>
                </div>
                <div class="preschool-item">
                    <div class="preschool-name">üåü Solrosen F√∂rskola</div>
                    <div class="preschool-info">G√∂teborg ‚Ä¢ 38 barn ‚Ä¢ Privat ‚Ä¢ ‚≠ê 4.5</div>
                </div>
                <div class="preschool-item">
                    <div class="preschool-name">üåà Regnb√•gen F√∂rskola</div>
                    <div class="preschool-info">Malm√∂ ‚Ä¢ 52 barn ‚Ä¢ Kooperativ ‚Ä¢ ‚≠ê 4.8</div>
                </div>
                <div class="preschool-item">
                    <div class="preschool-name">üêª Bj√∂rng√•rden</div>
                    <div class="preschool-info">Uppsala ‚Ä¢ 41 barn ‚Ä¢ Kommunal ‚Ä¢ ‚≠ê 4.1</div>
                </div>
                <div class="preschool-item">
                    <div class="preschool-name">üå∏ K√∂rsb√§rsblomman</div>
                    <div class="preschool-info">Lund ‚Ä¢ 29 barn ‚Ä¢ Privat ‚Ä¢ ‚≠ê 4.6</div>
                </div>
            </div>
        </div>

        <div class="map-container">
            <div id="map"></div>
            <div class="loading-overlay" id="loadingOverlay">
                üó∫Ô∏è Laddar interaktiv 3D-karta...
            </div>
            
            <div class="controls">
                <button class="control-button" onclick="toggleView()">üîÑ 2D/3D</button>
                <button class="control-button" onclick="centerSweden()">üá∏üá™ Centrera</button>
                <button class="control-button" onclick="toggleHeatmap()">üî• V√§rmekartor</button>
            </div>
        </div>
    </div>

    <!-- Mapbox JS -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    
    <script>
        console.log('üöÄ Svenska F√∂rskolor Karta startar - WORKING VERSION!');
        
        // Mapbox setup
        mapboxgl.accessToken = 'pk.eyJ1Ijoic2tvZ3N0YWRpc2FrIiwiYSI6ImNtY3BhaXRpMjA0ZGcycHBqNHM4dmlwOW0ifQ.KKHGGPnrZVjNjDdITF-_bw';
        
        let map;
        let is3D = true;
        let showHeatmap = false;
        
        // Initialize map
        function initMap() {
            try {
                map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/light-v11',
                    center: [15.5, 62.0], // Center of Sweden
                    zoom: 5.5,
                    pitch: 45,
                    bearing: 0
                });
                
                map.on('load', () => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                    console.log('üó∫Ô∏è Karta laddad framg√•ngsrikt');
                    
                    // Add sample preschool markers
                    addSampleMarkers();
                    
                    // Add 3D buildings
                    add3DBuildings();
                });
                
                map.on('error', (e) => {
                    console.error('Map error:', e);
                    document.getElementById('loadingOverlay').innerHTML = '‚ùå Kartfel: ' + e.error.message;
                });
                
            } catch (e) {
                console.error('Init error:', e);
                document.getElementById('loadingOverlay').innerHTML = '‚ùå Mapbox init fel: ' + e.message;
            }
        }
        
        // Add sample markers for demonstration
        function addSampleMarkers() {
            const samplePreschools = [
                { name: 'L√§sanden F√∂rskola', coords: [18.0686, 59.3293], city: 'Stockholm' },
                { name: 'Solrosen F√∂rskola', coords: [11.9746, 57.7089], city: 'G√∂teborg' },
                { name: 'Regnb√•gen F√∂rskola', coords: [13.0038, 55.6050], city: 'Malm√∂' },
                { name: 'Bj√∂rng√•rden', coords: [17.6389, 59.8586], city: 'Uppsala' },
                { name: 'K√∂rsb√§rsblomman', coords: [13.1923, 55.7047], city: 'Lund' }
            ];
            
            samplePreschools.forEach(preschool => {
                const marker = new mapboxgl.Marker({
                    color: '#3b82f6',
                    scale: 0.8
                })
                .setLngLat(preschool.coords)
                .setPopup(new mapboxgl.Popup().setHTML(`
                    <h3>üè´ ${preschool.name}</h3>
                    <p><strong>Stad:</strong> ${preschool.city}</p>
                    <p><strong>Typ:</strong> Kommunal f√∂rskola</p>
                    <p><strong>Status:</strong> Demo-data</p>
                `))
                .addTo(map);
            });
            
            console.log('‚úÖ Sample markers added successfully');
        }
        
        // Add 3D buildings
        function add3DBuildings() {
            map.addLayer({
                'id': '3d-buildings',
                'source': 'composite',
                'source-layer': 'building',
                'filter': ['==', 'extrude', 'true'],
                'type': 'fill-extrusion',
                'minzoom': 15,
                'paint': {
                    'fill-extrusion-color': '#aaa',
                    'fill-extrusion-height': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        15, 0,
                        15.05, ['get', 'height']
                    ],
                    'fill-extrusion-base': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        15, 0,
                        15.05, ['get', 'min_height']
                    ],
                    'fill-extrusion-opacity': 0.6
                }
            });
            console.log('‚úÖ 3D buildings added successfully');
        }
        
        // Control functions
        function toggleView() {
            is3D = !is3D;
            map.easeTo({
                pitch: is3D ? 45 : 0,
                bearing: is3D ? -17.6 : 0,
                duration: 1000
            });
            console.log('View toggled to:', is3D ? '3D' : '2D');
        }
        
        function centerSweden() {
            map.flyTo({
                center: [15.5, 62.0],
                zoom: 5.5,
                pitch: 45,
                bearing: 0,
                duration: 2000
            });
            console.log('Map centered on Sweden');
        }
        
        function toggleHeatmap() {
            showHeatmap = !showHeatmap;
            console.log('Heatmap toggle:', showHeatmap);
            // Heatmap implementation would go here
        }
        
        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            console.log('S√∂kning:', searchTerm);
            // Search implementation would go here
        });
        
        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('üöÄ Svenska F√∂rskolor Karta startar...');
            setTimeout(initMap, 100); // Small delay to ensure DOM is ready
        });
        
        // Error handling
        window.addEventListener('error', (e) => {
            console.error('‚ùå Global error:', e.error);
            document.getElementById('loadingOverlay').innerHTML = 
                '‚ùå Fel vid laddning. <br><a href="https://fosko.lovable.app" target="_blank">Prova live demo</a>';
        });
        
        console.log('‚úÖ Svenska F√∂rskolor Karta script loaded successfully');
    </script>
</body>
</html>